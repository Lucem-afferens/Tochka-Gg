---
rule_type: always
description: WordPress CMS integration rules and best practices
---

# WordPress CMS Integration Rules

## Core Principles

- **Разделение логики и контента:** Вся динамическая информация (цены, количество мест, фотографии, контакты, новости, турниры) должна управляться через WordPress Admin Panel
- **Тема WordPress:** Сайт создается как кастомная WordPress тема
- **Управление контентом:** Администратор должен иметь возможность изменять весь контент без редактирования кода

---

## Структура WordPress Темы

### Обязательная структура файлов:
```
theme-name/
├── style.css (обязательный заголовок темы)
├── functions.php (инициализация темы, хуки, регистрация скриптов)
├── index.php (основной шаблон)
├── header.php (шапка сайта)
├── footer.php (подвал сайта)
├── single.php (страница отдельной записи)
├── page.php (страница)
├── archive.php (архив записей)
├── template-parts/ (переиспользуемые части шаблонов)
│   ├── content/
│   ├── components/
│   └── sections/
├── assets/
│   ├── css/ (компилированные стили)
│   ├── js/ (JavaScript файлы)
│   ├── images/
│   └── fonts/
└── inc/ (вспомогательные PHP файлы)
    ├── custom-post-types.php
    ├── custom-fields.php
    ├── theme-setup.php
    └── enqueue-scripts.php
```

---

## WordPress Functions & Hooks

### Обязательные практики:

1. **Регистрация стилей и скриптов:**
   - Использовать `wp_enqueue_style()` и `wp_enqueue_script()`
   - Все через `functions.php` в хуке `wp_enqueue_scripts`
   - Указывать зависимости, версии
   - Использовать `get_template_directory_uri()` для путей

2. **Безопасность:**
   - Всегда использовать функции экранирования:
     - `esc_html()`, `esc_attr()`, `esc_url()`, `esc_textarea()`
     - `wp_kses_post()` для разрешенного HTML
   - Использовать `wp_nonce_field()` для форм
   - Валидировать и санитизировать данные: `sanitize_text_field()`, `intval()`, `absint()`

3. **Поддержка WordPress функций:**
   - `add_theme_support()` для поддержки функций (thumbnails, title-tag, etc.)
   - Использовать стандартные хуки WordPress
   - Следовать WordPress Coding Standards

---

## Управление контентом через CMS

### Advanced Custom Fields (ACF) - Рекомендуемый подход

1. **Для всех динамических данных использовать ACF:**
   - Цены и тарифы → ACF Fields (Repeater/Group)
   - Характеристики компьютеров → ACF Fields
   - Контактные данные → ACF Options Page
   - Фотографии → ACF Image Fields
   - Количество мест → ACF Number Fields

2. **Структура ACF для основных разделов:**

   **Главная страница:**
   - Hero секция (заголовок, описание, изображения)
   - О клубе (текст, изображение)
   - Преимущества (Repeater: иконка, заголовок, описание)

   **Цены:**
   - Тарифная сетка (Repeater для каждого тарифа)
   - Поля: название, время, LITE Пн-Чт, LITE Пт-Вс, VIP Пн-Чт, VIP Пт-Вс

   **Оборудование:**
   - Компьютеры (Repeater для каждой категории)
   - Поля: категория, видеокарта, процессор, память, количество
   - Периферия (Repeater)

   **Контакты:**
   - Адрес, телефон, email (Options Page)
   - Социальные сети (Repeater)
   - Карта (координаты)

3. **Кастомные типы записей (Custom Post Types):**
   - `tournaments` - Турниры
   - `news` - Новости
   - Использовать `register_post_type()` в `functions.php`

---

## Правила кодирования для WordPress

### PHP код:

1. **Всегда использовать теги WordPress:**
   ```php
   <?php get_header(); ?>
   <?php get_footer(); ?>
   <?php get_template_part('template-parts/content', 'section'); ?>
   ```

2. **Работа с контентом:**
   - Использовать `the_content()`, `the_title()`, `the_excerpt()`
   - Для ACF: `get_field()`, `the_field()`, `have_rows()` для Repeater
   - Проверять существование: `if(get_field('field_name'))`

3. **Цикл WordPress:**
   - Использовать стандартный Loop: `if (have_posts()) : while (have_posts()) : the_post();`
   - Или `WP_Query` для кастомных запросов
   - Всегда сбрасывать: `wp_reset_postdata()`

4. **Изображения:**
   - Использовать `wp_get_attachment_image()` или ACF функции
   - Добавлять размеры изображений через `add_image_size()`
   - Использовать `get_the_post_thumbnail()` для миниатюр

---

## Интеграция с существующей сборкой

### Работа с Vite и SASS:

1. **Сборка стилей и скриптов:**
   - Компилировать SASS в CSS через Vite
   - Результат сохранять в `assets/css/` и `assets/js/`
   - В WordPress подключать скомпилированные файлы через `wp_enqueue_*`

2. **Структура исходников:**
   ```
   src/
   ├── sass/
   │   ├── style.scss (основной файл)
   │   ├── components/
   │   └── sections/
   └── js/
       ├── main.js
       └── modules/
   ```

3. **Build процесс:**
   - Vite собирает в `dist/` или напрямую в `theme-name/assets/`
   - После сборки файлы доступны в WordPress теме
   - Настроить пути в `vite.config.mjs` под структуру темы

---

## Доступность и SEO

1. **Использовать WordPress функции SEO:**
   - `wp_head()` для meta тегов
   - Поддержка плагинов SEO (Yoast, Rank Math)
   - Правильная структура заголовков (h1-h6)

2. **Доступность:**
   - Семантический HTML5
   - ARIA атрибуты где необходимо
   - Правильная структура навигации

---

## Производительность

1. **Оптимизация:**
   - Ленивая загрузка изображений (`loading="lazy"`)
   - Минификация CSS/JS через Vite
   - Использование `wp_enqueue_script(..., array(), 'version', true)` для defer
   - Кэширование через плагины WordPress

2. **Базы данных:**
   - Использовать `WP_Query` эффективно
   - Избегать N+1 запросов
   - Использовать `wp_cache` где возможно

---

## Тестирование

1. **Проверять:**
   - Работу всех ACF полей
   - Корректность отображения при изменении контента
   - Отзывчивость на разных устройствах
   - Совместимость с последними версиями WordPress

2. **Обязательные проверки:**
   - Изменение цен через админку → отображаются на сайте
   - Добавление новости → появляется на сайте
   - Изменение контактов → обновляются везде
   - Загрузка изображений → оптимизируются и отображаются

---

## Документирование

1. **Для администратора:**
   - Создавать инструкции по работе с ACF полями
   - Описывать структуру управления контентом
   - Указывать какие поля обязательны

2. **В коде:**
   - Комментировать сложные участки
   - Указывать назначение кастомных функций
   - Документировать хуки и фильтры

---

## Важно

- **Никогда не хардкодить контент** который должен изменяться
- **Всегда проверять существование данных** перед выводом
- **Использовать стандартные WordPress практики** для совместимости
- **Тестировать изменения контента** через админ панель
- **Обеспечивать обратную совместимость** при обновлениях
