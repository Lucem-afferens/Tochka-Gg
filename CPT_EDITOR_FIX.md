# Исправление проблем с редактором контента и публикацией

## Проблемы, которые были исправлены:

1. ✅ **Редактор контента не отображался** - добавлена полная поддержка `editor` и других стандартных полей
2. ✅ **Нельзя было опубликовать записи** - исправлены права доступа через `map_meta_cap`
3. ✅ **Добавлена поддержка ревизий** - теперь можно видеть историю изменений
4. ✅ **Добавлена поддержка custom-fields** - для работы с SCF полями

---

## Что изменено:

### Для турниров и новостей:

1. **Убраны явные `capabilities`** - теперь используется `map_meta_cap => true`, который автоматически создает все нужные права доступа на основе `capability_type => 'post'`

2. **Расширен список `supports`**:
   - `title` - заголовок записи
   - `editor` - **редактор контента** (Gutenberg или классический)
   - `thumbnail` - миниатюра записи
   - `excerpt` - краткое описание
   - `custom-fields` - дополнительные поля (для SCF)
   - `revisions` - ревизии (история изменений)
   - `author` - автор (только для новостей)

3. **Добавлена поддержка REST API**:
   - `rest_base` - базовый путь для REST API
   - `rest_controller_class` - контроллер для REST API

---

## Что нужно сделать после обновления:

### 1. Обновите код на сервере
- Загрузите обновленный файл `theme/inc/custom-post-types.php`
- Или выполните `git pull` на сервере

### 2. Пересохраните постоянные ссылки
- **Настройки → Постоянные ссылки**
- Нажмите **"Сохранить изменения"** (без изменений)

### 3. Очистите кеш (если используете)
- Очистите кеш WordPress
- Очистите кеш браузера

### 4. Проверьте права доступа пользователя
- Убедитесь, что вы вошли как **Администратор** или **Редактор**
- Проверьте: **Пользователи → Ваш профиль** → роль должна быть "Администратор" или "Редактор"

---

## Где находится редактор контента:

### В админке WordPress:

1. **Турниры → Добавить новый** (или редактировать существующий)
2. **Новости → Добавить новую** (или редактировать существующую)

### В редакторе записи вы увидите:

- **Заголовок** - поле для названия турнира/новости
- **Редактор контента** - большое поле с кнопками форматирования (Gutenberg блоки или классический редактор)
- **Миниатюра записи** - в правой колонке "Миниатюра записи"
- **Краткое описание** - в правой колонке "Отрывок"
- **Поля SCF** - внизу страницы (если созданы группы полей)

---

## Если редактор все еще не виден:

### Вариант 1: Проверьте настройки экрана

1. В редакторе записи нажмите **"Настройки экрана"** (вверху справа)
2. Убедитесь, что галочка стоит напротив **"Редактор"**

### Вариант 2: Переключитесь на классический редактор

Если используете Gutenberg и он не работает:

1. Установите плагин **"Classic Editor"**
2. Или в настройках WordPress: **Настройки → Написание → Редактор по умолчанию** → выберите "Классический редактор"

### Вариант 3: Проверьте конфликты плагинов

1. Временно деактивируйте все плагины (кроме Secure Custom Fields)
2. Проверьте, появился ли редактор
3. Если да - активируйте плагины по одному, чтобы найти конфликтующий

---

## Если все еще нельзя опубликовать:

1. **Проверьте консоль браузера** (F12 → Console) на наличие ошибок JavaScript
2. **Проверьте логи WordPress** (`wp-content/debug.log`) на наличие ошибок PHP
3. **Попробуйте сохранить как черновик**, затем вручную изменить статус на "Опубликовано"
4. **Убедитесь, что заполнено обязательное поле "Заголовок"**

---

## Дополнительная информация:

- Редактор контента поддерживает как **Gutenberg** (блочный редактор), так и **классический редактор** WordPress
- Все стандартные функции WordPress доступны: форматирование текста, вставка изображений, ссылок и т.д.
- Поля SCF отображаются отдельно внизу страницы редактирования

