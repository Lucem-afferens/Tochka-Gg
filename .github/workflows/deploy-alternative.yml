name: Deploy Alternative (Manual)

on:
  workflow_dispatch:
    inputs:
      deploy_method:
        description: '–°–ø–æ—Å–æ–± –¥–µ–ø–ª–æ—è'
        required: true
        default: 'ftp'
        type: choice
        options:
        - ftp
        - rsync
        - manual

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.1'
        
    - name: Prepare files
      run: |
        echo "üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –¥–µ–ø–ª–æ—è..."
        cd ./dist
        
        # –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤ –¥–ª—è —Ä—É—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        tar -czf ../../manual-deploy.tar.gz .
        
        echo "‚úÖ –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω: manual-deploy.tar.gz"
        echo "üìã –†–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞:"
        ls -lh ../../manual-deploy.tar.gz
        
    - name: Upload artifact
      uses: actions/upload-artifact@v3
      with:
        name: deploy-files
        path: manual-deploy.tar.gz
        
    - name: Deploy via FTP (if selected)
      if: ${{ github.event.inputs.deploy_method == 'ftp' }}
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ${{ secrets.FTP_HOST }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        local-dir: ./dist/
        server-dir: ${{ secrets.FTP_PATH }}
        dangerous-clean-slate: false
        dry-run: false
        log-level: verbose
        
    - name: Deploy via rsync (if selected)
      if: ${{ github.event.inputs.deploy_method == 'rsync' }}
      run: |
        echo "üöÄ –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ rsync..."
        # –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã rsync –∑–¥–µ—Å—å
        
    - name: Manual deploy instructions
      if: ${{ github.event.inputs.deploy_method == 'manual' }}
      run: |
        echo "üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:"
        echo "1. –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ manual-deploy.tar.gz –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤"
        echo "2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
        echo "3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É —Å–∞–π—Ç–∞"
        echo "4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: chmod 755 –¥–ª—è –ø–∞–ø–æ–∫, 644 –¥–ª—è —Ñ–∞–π–ª–æ–≤"
        echo "5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ setup-webhook.php –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞"
